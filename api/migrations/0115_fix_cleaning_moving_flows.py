# Generated by Django 4.2 for fixing cleaning/moving consultation flows

from django.db import migrations


# ì²­ì†ŒÂ·ì´ì‚¬ í”Œë¡œìš° ë°ì´í„° (ì²­ì†Œì—…ì²´ ì¹´í…Œê³ ë¦¬ì— ì €ì¥)
CLEANING_MOVING_FLOWS = [
    {
        'step_number': 1,
        'question': 'ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ í•„ìš”í•˜ì„¸ìš”?',
        'options': [
            {'key': 'moving', 'label': 'ì´ì‚¬ ì„œë¹„ìŠ¤', 'icon': 'ğŸšš', 'description': 'ê°€ì •/ì‚¬ë¬´ì‹¤ ì´ì‚¬, í¬ì¥ì´ì‚¬ ë“±'},
            {'key': 'cleaning', 'label': 'ì²­ì†Œ ì„œë¹„ìŠ¤', 'icon': 'ğŸ§¹', 'description': 'ì…ì£¼ì²­ì†Œ, ì •ê¸°ì²­ì†Œ, íŠ¹ìˆ˜ì²­ì†Œ ë“±'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
    # ì´ì‚¬ ì„ íƒ ì‹œ ì§ˆë¬¸ë“¤
    {
        'step_number': 2,
        'question': 'ì–´ë–¤ ì´ì‚¬ì¸ê°€ìš”?',
        'depends_on_step': 1,
        'depends_on_options': ['moving'],
        'options': [
            {'key': 'home_move', 'label': 'ê°€ì • ì´ì‚¬', 'icon': 'ğŸ '},
            {'key': 'office_move', 'label': 'ì‚¬ë¬´ì‹¤ ì´ì‚¬', 'icon': 'ğŸ¢'},
            {'key': 'small_move', 'label': 'ì›ë£¸/ì†Œí˜• ì´ì‚¬', 'icon': 'ğŸ“¦'},
            {'key': 'long_distance', 'label': 'ì¥ê±°ë¦¬ ì´ì‚¬', 'icon': 'ğŸš›'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
    # ì²­ì†Œ ì„ íƒ ì‹œ ì§ˆë¬¸ë“¤
    {
        'step_number': 2,
        'question': 'ì–´ë–¤ ì²­ì†Œê°€ í•„ìš”í•˜ì„¸ìš”?',
        'depends_on_step': 1,
        'depends_on_options': ['cleaning'],
        'options': [
            {'key': 'move_in', 'label': 'ì…ì£¼ ì²­ì†Œ', 'icon': 'ğŸ '},
            {'key': 'move_out', 'label': 'ì´ì‚¬ ì²­ì†Œ', 'icon': 'ğŸ“¦'},
            {'key': 'regular', 'label': 'ì •ê¸° ì²­ì†Œ', 'icon': 'âœ¨'},
            {'key': 'special', 'label': 'íŠ¹ìˆ˜ ì²­ì†Œ', 'icon': 'ğŸ§½', 'description': 'ì—ì–´ì»¨, ìƒˆì§‘ì¦í›„êµ° ë“±'},
            {'key': 'office', 'label': 'ì‚¬ë¬´ì‹¤/ìƒê°€ ì²­ì†Œ', 'icon': 'ğŸ¢'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
    {
        'step_number': 3,
        'question': 'ê³µê°„ í¬ê¸°ëŠ”?',
        'options': [
            {'key': 'studio', 'label': 'ì›ë£¸/íˆ¬ë£¸', 'icon': 'ğŸ›ï¸'},
            {'key': 'under_20', 'label': '20í‰ ë¯¸ë§Œ', 'icon': 'ğŸ“'},
            {'key': '20_to_30', 'label': '20~30í‰', 'icon': 'ğŸ“'},
            {'key': '30_to_40', 'label': '30~40í‰', 'icon': 'ğŸ '},
            {'key': 'over_40', 'label': '40í‰ ì´ìƒ', 'icon': 'ğŸ¡'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
    {
        'step_number': 4,
        'question': 'í¬ë§ ë‚ ì§œëŠ”?',
        'options': [
            {'key': 'this_week', 'label': 'ì´ë²ˆ ì£¼', 'icon': 'ğŸ“…'},
            {'key': 'next_week', 'label': 'ë‹¤ìŒ ì£¼', 'icon': 'ğŸ—“ï¸'},
            {'key': 'within_month', 'label': 'í•œ ë‹¬ ì´ë‚´', 'icon': 'ğŸ“†'},
            {'key': 'specific_date', 'label': 'íŠ¹ì • ë‚ ì§œ ì§€ì •', 'icon': 'âœ…'},
            {'key': 'flexible', 'label': 'í˜‘ì˜ ê°€ëŠ¥', 'icon': 'ğŸ¤'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
    # ì´ì‚¬: ì¶”ê°€ ì„œë¹„ìŠ¤
    {
        'step_number': 5,
        'question': 'ì¶”ê°€ ì„œë¹„ìŠ¤ê°€ í•„ìš”í•˜ì„¸ìš”?',
        'depends_on_step': 1,
        'depends_on_options': ['moving'],
        'options': [
            {'key': 'packing', 'label': 'í¬ì¥ ì„œë¹„ìŠ¤', 'icon': 'ğŸ“¦'},
            {'key': 'storage', 'label': 'ë³´ê´€ ì„œë¹„ìŠ¤', 'icon': 'ğŸª'},
            {'key': 'disposal', 'label': 'íê¸°ë¬¼ ì²˜ë¦¬', 'icon': 'ğŸ—‘ï¸'},
            {'key': 'cleaning_too', 'label': 'ì²­ì†Œë„ í•¨ê»˜', 'icon': 'ğŸ§¹'},
            {'key': 'none', 'label': 'ì—†ìŒ', 'icon': 'âœ…'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
    # ì²­ì†Œ: ì¶”ê°€ ìš”ì²­
    {
        'step_number': 5,
        'question': 'ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì„¸ìš”?',
        'depends_on_step': 1,
        'depends_on_options': ['cleaning'],
        'options': [
            {'key': 'aircon', 'label': 'ì—ì–´ì»¨ ì²­ì†Œ í¬í•¨', 'icon': 'â„ï¸'},
            {'key': 'kitchen', 'label': 'ì£¼ë°© ì§‘ì¤‘ ì²­ì†Œ', 'icon': 'ğŸ³'},
            {'key': 'bathroom', 'label': 'ìš•ì‹¤ ì§‘ì¤‘ ì²­ì†Œ', 'icon': 'ğŸš¿'},
            {'key': 'window', 'label': 'ì°½ë¬¸ ì²­ì†Œ í¬í•¨', 'icon': 'ğŸªŸ'},
            {'key': 'none', 'label': 'ê¸°ë³¸ ì²­ì†Œë§Œ', 'icon': 'âœ…'},
            {'key': 'custom', 'label': 'ì§ì ‘ ì…ë ¥', 'icon': 'ğŸ“', 'is_custom_input': True},
        ]
    },
]


def populate_cleaning_moving_flows(apps, schema_editor):
    """ì²­ì†Œ ì „ë¬¸ ì¹´í…Œê³ ë¦¬ì— ì²­ì†ŒÂ·ì´ì‚¬ í”Œë¡œìš° ë°ì´í„° ìƒì„±"""
    LocalBusinessCategory = apps.get_model('api', 'LocalBusinessCategory')
    ConsultationFlow = apps.get_model('api', 'ConsultationFlow')
    ConsultationFlowOption = apps.get_model('api', 'ConsultationFlowOption')

    # ì²­ì†Œ ì „ë¬¸ ì¹´í…Œê³ ë¦¬ ì°¾ê¸°
    try:
        category = LocalBusinessCategory.objects.get(name='ì²­ì†Œ ì „ë¬¸')
    except LocalBusinessCategory.DoesNotExist:
        # ì²­ì†Œ ì „ë¬¸ì´ ì—†ìœ¼ë©´ ì´ì‚¬ ì „ë¬¸ ì‹œë„
        try:
            category = LocalBusinessCategory.objects.get(name='ì´ì‚¬ ì „ë¬¸')
        except LocalBusinessCategory.DoesNotExist:
            print('ì²­ì†Œ ì „ë¬¸/ì´ì‚¬ ì „ë¬¸ ì¹´í…Œê³ ë¦¬ ì—†ìŒ - ê±´ë„ˆëœ€')
            return

    # í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ê¸°ì¡´ í”Œë¡œìš° ì‚­ì œ
    ConsultationFlow.objects.filter(category=category).delete()

    # ìƒˆ í”Œë¡œìš° ìƒì„±
    for idx, flow_data in enumerate(CLEANING_MOVING_FLOWS):
        flow = ConsultationFlow.objects.create(
            category=category,
            step_number=flow_data['step_number'],
            question=flow_data['question'],
            is_required=flow_data.get('is_required', True),
            depends_on_step=flow_data.get('depends_on_step'),
            depends_on_options=flow_data.get('depends_on_options', []),
            order_index=idx,
            is_active=True,
        )

        # ì˜µì…˜ ìƒì„±
        for opt_idx, option_data in enumerate(flow_data.get('options', [])):
            ConsultationFlowOption.objects.create(
                flow=flow,
                key=option_data['key'],
                label=option_data['label'],
                icon=option_data.get('icon', ''),
                description=option_data.get('description', ''),
                is_custom_input=option_data.get('is_custom_input', False),
                order_index=opt_idx,
                is_active=True,
            )

    print(f'ì²­ì†Œì—…ì²´ ì¹´í…Œê³ ë¦¬ í”Œë¡œìš° ìƒì„± ì™„ë£Œ ({len(CLEANING_MOVING_FLOWS)}ê°œ)')


def reverse_populate(apps, schema_editor):
    """ë¡¤ë°± ì‹œ ë°ì´í„° ì‚­ì œ"""
    LocalBusinessCategory = apps.get_model('api', 'LocalBusinessCategory')
    ConsultationFlow = apps.get_model('api', 'ConsultationFlow')

    try:
        category = LocalBusinessCategory.objects.get(name='ì²­ì†Œ ì „ë¬¸')
        ConsultationFlow.objects.filter(category=category).delete()
    except LocalBusinessCategory.DoesNotExist:
        pass


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0114_add_logo_to_consultation_flow_option'),
    ]

    operations = [
        migrations.RunPython(populate_cleaning_moving_flows, reverse_populate),
    ]
